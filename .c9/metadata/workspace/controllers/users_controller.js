{"filter":false,"title":"users_controller.js","tooltip":"/controllers/users_controller.js","undoManager":{"mark":61,"position":61,"stack":[[{"group":"doc","deltas":[{"start":{"row":20,"column":38},"end":{"row":25,"column":38},"action":"remove","lines":["","    user.set('classification', req.body.classification);","    user.set('status', req.body.status);","    user.set('portfolio', req.body.portfolio);","    user.set('linkedin', req.body.linkedin);","    user.set('usersince', Date.now());"]}]}],[{"group":"doc","deltas":[{"start":{"row":85,"column":46},"end":{"row":89,"column":52},"action":"remove","lines":["","            user.set('classification', req.body.classification);","            user.set('status', req.body.status);","            user.set('portfolio', req.body.portfolio);","            user.set('linkedin', req.body.linkedin);"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":137,"column":1},"action":"remove","lines":["// Defines the functionality for the routes that require interaction","// with the MongoDB database model, including adding, retrieving,","// and deleting user objects","","var crypto = require('crypto');","var mongoose = require('mongoose'),","    User = mongoose.model('User');","","function hashPW(pwd) {","    return crypto.createHash('sha256').update(pwd).","    digest('base64').toString();","}","exports.signup = function(req, res) {","    var user = new User({","        username: req.body.username","    });","    user.set('hashed_password', hashPW(req.body.password));","    user.set('firstname', req.body.firstname);","    user.set('lastname', req.body.lastname);","    user.set('email', req.body.email);","    user.set('phone', req.body.phone);","    user.save(function(err) {","        if (err) {","            res.session.error = err;","            res.redirect('/signup');","        }","        else {","            req.session.user = user.id;","            req.session.username = user.username;","            req.session.msg = 'Authenticated as ' + user.username;","            res.redirect('/');","        }","    });","};","exports.login = function(req, res) {","    User.findOne({","            username: req.body.username","        })","        .exec(function(err, user) {","            if (!user) {","                err = 'User Not Found.';","            }","            else if (user.hashed_password ===","                hashPW(req.body.password.toString())) {","                req.session.regenerate(function() {","                    req.session.user = user.id;","                    req.session.username = user.username;","                    req.session.msg = 'Authenticated as ' + user.username;","                    res.redirect('/');","                });","            }","            else {","                err = 'Authentication failed.';","            }","            if (err) {","                req.session.regenerate(function() {","                    req.session.msg = err;","                    res.redirect('/login');","                });","            }","        });","};","exports.getUserProfile = function(req, res) {","    User.findOne({","            _id: req.session.user","        })","        .exec(function(err, user) {","            if (!user) {","                res.json(404, {","                    err: 'User Not Found.'","                });","            }","            else {","                res.json(user);","            }","        });","};","exports.updateUser = function(req, res) {","    User.findOne({","            _id: req.session.user","        })","        .exec(function(err, user) {","            user.set('firstname', req.body.firstname);","            user.set('lastname', req.body.lastname);","            user.set('email', req.body.email);","            user.set('phone', req.body.phone);","            user.save(function(err) {","                if (err) {","                    res.sessor.error = err;","                }","                else {","                    req.session.msg = 'User Updated.';","                }","                res.redirect('/user');","            });","        });","};","exports.deleteUser = function(req, res) {","    User.findOne({","            _id: req.session.user","        })","        .exec(function(err, user) {","            if (user) {","                user.remove(function(err) {","                    if (err) {","                        req.session.msg = err;","                    }","                    req.session.destroy(function() {","                        res.redirect('/login');","                    });","                });","            }","            else {","                req.session.msg = \"User Not Found!\";","                req.session.destroy(function() {","                    res.redirect('/login');","                });","            }","        });","};","","exports.userProfile = function(req, res)","{","    User.findOne(","        {","            _id: req.session.user","        })","        .exec(function(err, user) {","            if (!user) {","                res.json(404, {","                    err: 'User Not Found.'","                });","            }","            else {","                res.json(user);","            }","        });","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":117,"column":2},"action":"insert","lines":["var crypto = require('crypto');","var mongoose = require('mongoose'),","    User = mongoose.model('User');","","function hashPW(pwd) {","    return crypto.createHash('sha256').update(pwd).","    digest('base64').toString();","}","","/*this is the code that is called when a user signs up","  notice that it is exported.","*/","exports.signup = function(req, res) {","    //User was defined in the schema","    //notice how we construct the user here","    var user = new User({","        username: req.body.username","    });","    user.set('hashed_password', hashPW(req.body.password));","    user.set('email', req.body.email);","    //using mongoose, this is a write to the database","    user.save(function(err) {","        if (err) {","            res.session.error = err;","            res.redirect('/signup');","        }","        else {","            req.session.user = user.id;","            req.session.username = user.username;","            req.session.msg = 'Authenticated as ' + user.username;","            res.redirect('/');","        }","    });","};","exports.login = function(req, res) {","    User.findOne({","            username: req.body.username","        })","        .exec(function(err, user) {","            if (!user) {","                err = 'User Not Found.';","            }","            else if (user.hashed_password ===","                hashPW(req.body.password.toString())) {","                req.session.regenerate(function() {","                    req.session.user = user.id;","                    req.session.username = user.username;","                    req.session.msg = 'Authenticated as ' + user.username;","                    res.redirect('/');","                });","            }","            else {","                err = 'Authentication failed.';","            }","            if (err) {","                req.session.regenerate(function() {","                    req.session.msg = err;","                    res.redirect('/login');","                });","            }","        });","};","exports.getUserProfile = function(req, res) {","    User.findOne({","            _id: req.session.user","        })","        .exec(function(err, user) {","            if (!user) {","                res.json(404, {","                    err: 'User Not Found.'","                });","            }","            else {","                res.json(user);","            }","        });","};","exports.updateUser = function(req, res) {","    User.findOne({","            _id: req.session.user","        })","        .exec(function(err, user) {","            user.set('email', req.body.email);","            user.set('color', req.body.color);","            user.save(function(err) {","                if (err) {","                    res.sessor.error = err;","                }","                else {","                    req.session.msg = 'User Updated.';","                }","                res.redirect('/user');","            });","        });","};","exports.deleteUser = function(req, res) {","    User.findOne({","            _id: req.session.user","        })","        .exec(function(err, user) {","            if (user) {","                user.remove(function(err) {","                    if (err) {","                        req.session.msg = err;","                    }","                    req.session.destroy(function() {","                        res.redirect('/login');","                    });","                });","            }","            else {","                req.session.msg = \"User Not Found!\";","                req.session.destroy(function() {","                    res.redirect('/login');","                });","            }","        });","};"]}]}],[{"group":"doc","deltas":[{"start":{"row":82,"column":46},"end":{"row":83,"column":46},"action":"remove","lines":["","            user.set('color', req.body.color);"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":38},"end":{"row":20,"column":0},"action":"insert","lines":["",""]},{"start":{"row":20,"column":0},"end":{"row":20,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":4},"end":{"row":20,"column":38},"action":"insert","lines":["user.set('email', req.body.email);"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":14},"end":{"row":20,"column":19},"action":"remove","lines":["email"]},{"start":{"row":20,"column":14},"end":{"row":20,"column":15},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":15},"end":{"row":20,"column":16},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":16},"end":{"row":20,"column":17},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":17},"end":{"row":20,"column":18},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":18},"end":{"row":20,"column":19},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":31},"end":{"row":20,"column":36},"action":"remove","lines":["email"]},{"start":{"row":20,"column":31},"end":{"row":20,"column":32},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":32},"end":{"row":20,"column":33},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":33},"end":{"row":20,"column":34},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":34},"end":{"row":20,"column":35},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":35},"end":{"row":20,"column":36},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":59},"end":{"row":19,"column":0},"action":"insert","lines":["",""]},{"start":{"row":19,"column":0},"end":{"row":19,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":4},"end":{"row":19,"column":38},"action":"insert","lines":["user.set('email', req.body.email);"]}]}],[{"group":"doc","deltas":[{"start":{"row":84,"column":46},"end":{"row":85,"column":12},"action":"insert","lines":["","            "]}]}],[{"group":"doc","deltas":[{"start":{"row":84,"column":46},"end":{"row":85,"column":41},"action":"insert","lines":["","            user.set('email', req.body.);"]}]}],[{"group":"doc","deltas":[{"start":{"row":83,"column":35},"end":{"row":84,"column":42},"action":"insert","lines":["","            user.set('email', req.body.e);"]},{"start":{"row":86,"column":39},"end":{"row":86,"column":44},"action":"insert","lines":["phone"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":14},"end":{"row":19,"column":19},"action":"remove","lines":["email"]},{"start":{"row":19,"column":14},"end":{"row":19,"column":15},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":15},"end":{"row":19,"column":16},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":16},"end":{"row":19,"column":17},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":17},"end":{"row":19,"column":18},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":18},"end":{"row":19,"column":19},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":19},"end":{"row":19,"column":20},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":14},"end":{"row":19,"column":20},"action":"remove","lines":["firstn"]},{"start":{"row":19,"column":14},"end":{"row":19,"column":23},"action":"insert","lines":["firstname"]}]}],[{"group":"doc","deltas":[{"start":{"row":84,"column":39},"end":{"row":84,"column":40},"action":"remove","lines":["e"]},{"start":{"row":84,"column":39},"end":{"row":84,"column":42},"action":"insert","lines":["use"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":35},"end":{"row":19,"column":40},"action":"remove","lines":["email"]},{"start":{"row":19,"column":35},"end":{"row":19,"column":36},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":36},"end":{"row":19,"column":37},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":37},"end":{"row":19,"column":38},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":38},"end":{"row":19,"column":39},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":39},"end":{"row":19,"column":40},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":39},"end":{"row":19,"column":40},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":35},"end":{"row":19,"column":39},"action":"remove","lines":["firs"]},{"start":{"row":19,"column":35},"end":{"row":19,"column":44},"action":"insert","lines":["firstname"]}]}],[{"group":"doc","deltas":[{"start":{"row":84,"column":39},"end":{"row":84,"column":42},"action":"remove","lines":["use"]},{"start":{"row":84,"column":39},"end":{"row":84,"column":47},"action":"insert","lines":["username"]},{"start":{"row":84,"column":49},"end":{"row":85,"column":41},"action":"insert","lines":["","            user.set('email', req.body.);"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":46},"end":{"row":20,"column":0},"action":"insert","lines":["",""]},{"start":{"row":20,"column":0},"end":{"row":20,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":4},"end":{"row":20,"column":38},"action":"insert","lines":["user.set('email', req.body.email);"]}]}],[{"group":"doc","deltas":[{"start":{"row":86,"column":39},"end":{"row":86,"column":47},"action":"insert","lines":["password"]}]}],[{"group":"doc","deltas":[{"start":{"row":86,"column":39},"end":{"row":86,"column":49},"action":"remove","lines":["password);"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":14},"end":{"row":20,"column":19},"action":"remove","lines":["email"]},{"start":{"row":20,"column":14},"end":{"row":20,"column":15},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":15},"end":{"row":20,"column":16},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":16},"end":{"row":20,"column":17},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":17},"end":{"row":20,"column":18},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":14},"end":{"row":20,"column":18},"action":"remove","lines":["last"]},{"start":{"row":20,"column":14},"end":{"row":20,"column":22},"action":"insert","lines":["lastname"]}]}],[{"group":"doc","deltas":[{"start":{"row":86,"column":39},"end":{"row":87,"column":12},"action":"insert","lines":["firstname);","            "]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":34},"end":{"row":20,"column":39},"action":"remove","lines":["email"]},{"start":{"row":20,"column":34},"end":{"row":20,"column":35},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":35},"end":{"row":20,"column":36},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":36},"end":{"row":20,"column":37},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":37},"end":{"row":20,"column":38},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":38},"end":{"row":20,"column":39},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":39},"end":{"row":20,"column":40},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":34},"end":{"row":20,"column":40},"action":"remove","lines":["lastna"]},{"start":{"row":20,"column":34},"end":{"row":20,"column":42},"action":"insert","lines":["lastname"]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":12},"end":{"row":87,"column":44},"action":"insert","lines":["user.set('email', req.body.las);"]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":42},"end":{"row":87,"column":47},"action":"insert","lines":["tName"]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":43},"end":{"row":87,"column":44},"action":"remove","lines":["N"]},{"start":{"row":87,"column":43},"end":{"row":87,"column":44},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":86,"column":22},"end":{"row":86,"column":27},"action":"remove","lines":["email"]},{"start":{"row":86,"column":22},"end":{"row":86,"column":31},"action":"insert","lines":["firstname"]},{"start":{"row":87,"column":25},"end":{"row":87,"column":27},"action":"remove","lines":["il"]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":22},"end":{"row":87,"column":25},"action":"remove","lines":["ema"]},{"start":{"row":87,"column":22},"end":{"row":87,"column":30},"action":"insert","lines":["lastname"]},{"start":{"row":88,"column":22},"end":{"row":88,"column":27},"action":"remove","lines":["email"]},{"start":{"row":88,"column":22},"end":{"row":88,"column":25},"action":"insert","lines":["ema"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":22},"end":{"row":88,"column":25},"action":"remove","lines":["ema"]},{"start":{"row":88,"column":22},"end":{"row":88,"column":27},"action":"insert","lines":["email"]},{"start":{"row":89,"column":22},"end":{"row":89,"column":27},"action":"remove","lines":["email"]},{"start":{"row":89,"column":22},"end":{"row":89,"column":28},"action":"insert","lines":["phone "]}]}],[{"group":"doc","deltas":[{"start":{"row":89,"column":27},"end":{"row":89,"column":28},"action":"remove","lines":[" "]}]}]]},"ace":{"folds":[],"scrolltop":1080,"scrollleft":0,"selection":{"start":{"row":20,"column":42},"end":{"row":20,"column":42},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1416602433664,"hash":"036c2da7be0830a694ea339c9c79b204ecb44985"}